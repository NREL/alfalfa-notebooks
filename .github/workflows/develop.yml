name: Develop

on:
  push:
    branches-ignore: ['main']

jobs:
  integration:
    name: Integration Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

        - name: Install Python
          uses: actions/setup-python@v2
          with:
            python-version: "3.7"

        - name: Install poetry
          uses: abatilo/actions-poetry@v2.0.0
          with:
            poetry-version: "1.1.13"

        - name: Start Alfalfa
          uses: NREL/alfalfa-action@v1
          with:
            worker-scale: 2
            compose-file-ref: 'remove_worker_container_name'

        - name: Test notebooks
          run: |
            poetry run pytest --nbmake
          shell: bash
